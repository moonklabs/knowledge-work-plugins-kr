---
name: data-context-extractor
description: >
  회사별 데이터 분석 스킬을 생성하거나 개선합니다. 분석가로부터 조직 내부 지식을 추출합니다.

  부트스트랩 모드 - 트리거: "데이터 컨텍스트 스킬 생성", "우리 웨어하우스에 데이터 분석 설정",
  "데이터베이스용 스킬 생성 도와줘", "[회사명]용 데이터 스킬 생성"
  → 스키마를 탐색하고, 핵심 질문을 하고, 참조 파일이 포함된 초기 스킬을 생성합니다

  반복 모드 - 트리거: "[도메인]에 대한 컨텍스트 추가", "스킬에 [주제]에 대한 정보가 더 필요해",
  "[지표/테이블/용어]로 데이터 스킬 업데이트", "[도메인] 참조 개선"
  → 기존 스킬을 로드하고, 타겟 질문을 하고, 참조 파일을 추가/업데이트합니다

  데이터 분석가가 Claude에게 자사의 데이터 웨어하우스, 용어, 지표 정의,
  일반적인 쿼리 패턴을 이해시키고자 할 때 사용합니다.
---

# 데이터 컨텍스트 추출기

분석가로부터 회사별 데이터 지식을 추출하여 맞춤형 데이터 분석 스킬을 생성하는 메타 스킬입니다.

## 작동 방식

이 스킬에는 두 가지 모드가 있습니다:

1. **부트스트랩 모드**: 새로운 데이터 분석 스킬을 처음부터 생성
2. **반복 모드**: 도메인별 참조 파일을 추가하여 기존 스킬을 개선

---

## 부트스트랩 모드

사용 시점: 사용자가 자사 웨어하우스를 위한 새로운 데이터 컨텍스트 스킬을 생성하고자 할 때.

### 1단계: 데이터베이스 연결 및 탐색

**단계 1: 데이터베이스 유형 식별**

질문: "어떤 데이터 웨어하우스를 사용하고 계신가요?"

일반적인 옵션:
- **BigQuery**
- **Snowflake**
- **PostgreSQL/Redshift**
- **Databricks**

`~~data warehouse` 도구(쿼리 및 스키마)를 사용하여 연결합니다. 불명확한 경우 현재 세션에서 사용 가능한 MCP 도구를 확인합니다.

**단계 2: 스키마 탐색**

`~~data warehouse` 스키마 도구를 사용하여:
1. 사용 가능한 데이터셋/스키마를 나열합니다
2. 가장 중요한 테이블을 식별합니다 (사용자에게 질문: "분석가들이 가장 자주 쿼리하는 3-5개의 테이블은 무엇인가요?")
3. 해당 핵심 테이블의 스키마 세부사항을 가져옵니다

방언별 탐색 쿼리 샘플:
```sql
-- BigQuery: 데이터셋 나열
SELECT schema_name FROM INFORMATION_SCHEMA.SCHEMATA

-- BigQuery: 데이터셋 내 테이블 나열
SELECT table_name FROM `project.dataset.INFORMATION_SCHEMA.TABLES`

-- Snowflake: 스키마 나열
SHOW SCHEMAS IN DATABASE my_database

-- Snowflake: 테이블 나열
SHOW TABLES IN SCHEMA my_schema
```

### 2단계: 핵심 질문 (이 질문들을 합니다)

스키마 탐색 후 대화식으로 질문합니다 (한꺼번에 모두가 아닌):

**엔티티 구분 (핵심)**
> "이곳에서 '사용자'나 '고객'이라고 하면 정확히 무엇을 의미하나요? 다른 유형이 있나요?"

주의 깊게 들을 내용:
- 여러 엔티티 유형 (사용자 vs 계정 vs 조직)
- 엔티티 간 관계 (1:1, 1:다, 다:다)
- 엔티티를 연결하는 ID 필드

**주요 식별자**
> "[고객/사용자/계정]의 주 식별자는 무엇인가요? 동일 엔티티에 여러 ID가 있나요?"

주의 깊게 들을 내용:
- 기본 키 vs 비즈니스 키
- UUID vs 정수 ID
- 레거시 ID 시스템

**핵심 지표**
> "사람들이 가장 많이 문의하는 2-3개의 지표는 무엇인가요? 각각 어떻게 계산되나요?"

주의 깊게 들을 내용:
- 정확한 공식 (ARR = 월간 매출 x 12)
- 각 지표를 제공하는 테이블/컬럼
- 시간 기간 관례 (최근 7일, 역월 등)

**데이터 위생**
> "쿼리에서 항상 제외해야 하는 것은 무엇인가요? (테스트 데이터, 사기, 내부 사용자 등)"

주의 깊게 들을 내용:
- 항상 포함해야 하는 표준 WHERE 절
- 제외를 나타내는 플래그 컬럼 (is_test, is_internal, is_fraud)
- 제외할 특정 값 (status = 'deleted')

**일반적인 함정**
> "신입 분석가들이 이 데이터에서 보통 어떤 실수를 하나요?"

주의 깊게 들을 내용:
- 혼동하기 쉬운 컬럼명
- 시간대 문제
- NULL 처리 특이사항
- 이력 vs 현재 상태 테이블

### 3단계: 스킬 생성

다음 구조로 스킬을 생성합니다:

```
[company]-data-analyst/
├── SKILL.md
└── references/
    ├── entities.md          # 엔티티 정의 및 관계
    ├── metrics.md           # KPI 계산
    ├── tables/              # 도메인당 하나의 파일
    │   ├── [도메인1].md
    │   └── [도메인2].md
    └── dashboards.json      # 선택: 기존 대시보드 카탈로그
```

**SKILL.md 템플릿**: `references/skill-template.md`를 참조하십시오

**SQL 방언 섹션**: `references/sql-dialects.md`를 참조하여 적절한 방언 노트를 포함하십시오.

**참조 파일 템플릿**: `references/domain-template.md`를 참조하십시오

### 4단계: 패키징 및 전달

1. 스킬 디렉토리에 모든 파일을 생성합니다
2. zip 파일로 패키징합니다
3. 캡처된 내용의 요약과 함께 사용자에게 제시합니다

---

## 반복 모드

사용 시점: 사용자가 기존 스킬을 보유하고 있지만 더 많은 컨텍스트를 추가해야 할 때.

### 단계 1: 기존 스킬 로드

사용자에게 기존 스킬(zip 또는 폴더)을 업로드하도록 요청하거나, 세션에 이미 있는 경우 찾습니다.

현재 SKILL.md와 참조 파일을 읽어 이미 문서화된 내용을 파악합니다.

### 단계 2: 갭 식별

질문: "어떤 도메인이나 주제에 더 많은 컨텍스트가 필요한가요? 어떤 쿼리가 실패하거나 잘못된 결과를 내고 있나요?"

일반적인 갭:
- 새로운 데이터 도메인 (마케팅, 재무, 제품 등)
- 누락된 지표 정의
- 문서화되지 않은 테이블 관계
- 새로운 용어

### 단계 3: 타겟 탐색

식별된 도메인에 대해:

1. **관련 테이블 탐색**: `~~data warehouse` 스키마 도구를 사용하여 해당 도메인의 테이블을 찾습니다
2. **도메인별 질문**:
   - "[도메인] 분석에 사용되는 테이블은 무엇인가요?"
   - "[도메인]의 핵심 지표는 무엇인가요?"
   - "[도메인] 데이터에 특별한 필터나 함정이 있나요?"

3. **새 참조 파일 생성**: 도메인 템플릿을 사용하여 `references/[domain].md`를 생성합니다

### 단계 4: 업데이트 및 재패키징

1. 새 참조 파일을 추가합니다
2. SKILL.md의 "지식 베이스 탐색" 섹션을 업데이트하여 새 도메인을 포함합니다
3. 스킬을 재패키징합니다
4. 업데이트된 스킬을 사용자에게 제시합니다

---

## 참조 파일 표준

각 참조 파일에는 다음이 포함되어야 합니다:

### 테이블 문서화
- **위치**: 전체 테이블 경로
- **설명**: 이 테이블에 포함된 내용, 사용 시점
- **기본 키**: 행을 고유하게 식별하는 방법
- **업데이트 빈도**: 데이터 갱신 주기
- **주요 컬럼**: 컬럼명, 유형, 설명, 참고사항이 포함된 테이블
- **관계**: 다른 테이블과의 조인 방법
- **샘플 쿼리**: 2-3개의 일반적인 쿼리 패턴

### 지표 문서화
- **지표명**: 사람이 읽을 수 있는 이름
- **정의**: 평이한 언어로의 설명
- **공식**: 컬럼 참조가 포함된 정확한 계산식
- **소스 테이블**: 데이터 출처
- **주의사항**: 엣지 케이스, 제외사항, 함정

### 엔티티 문서화
- **엔티티명**: 호칭
- **정의**: 비즈니스에서 의미하는 바
- **주요 테이블**: 이 엔티티를 찾을 수 있는 테이블
- **ID 필드**: 식별 방법
- **관계**: 다른 엔티티와의 관계
- **일반 필터**: 표준 제외사항 (내부, 테스트 등)

---

## 품질 체크리스트

생성된 스킬을 전달하기 전에 확인합니다:

- [ ] SKILL.md에 완전한 프론트매터가 있음 (name, description)
- [ ] 엔티티 구분 섹션이 명확함
- [ ] 주요 용어가 정의되어 있음
- [ ] 표준 필터/제외사항이 문서화되어 있음
- [ ] 도메인당 최소 2-3개의 샘플 쿼리가 있음
- [ ] SQL이 올바른 방언 구문을 사용함
- [ ] 참조 파일이 SKILL.md 탐색 섹션에서 링크되어 있음
